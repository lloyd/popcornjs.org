var onYouTubePlayerReady;
(function(d){function i(a){if(a)return(a=j.exec(a))?a[1]:""}function k(a){if(a)return(a=j.exec(a))?a[1]:""}function h(a,c){var b,e=this;if(window.swfobject){b=c.getBoundingClientRect();this.width=c.style.width||460;this.height=c.style.height||350;this.width=parseFloat(this.width);this.height=parseFloat(this.height);this.offsetWidth=this.width;this.offsetHeight=this.height;this.offsetLeft=b.left;this.offsetTop=b.top;this.offsetParent=c.offsetParent;b={playerapiid:this.playerId,controls:this.controls,
iv_load_policy:this.iv_load_policy};swfobject.embedSWF("http://www.youtube.com/e/"+this.vidId+"?enablejsapi=1&playerapiid="+this.playerId+"&version=3",this.playerId,this.width,this.height,"8",null,b,{allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent"},{id:this.playerId})}else setTimeout(function(){h.call(e,a,c)},1)}var j=/^.*[\/=](.{11})/,g={},f={},m=Math.abs;d.getScript("http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js");onYouTubePlayerReady=function(a){var c=g[a];
f[a]=1;c.video=document.getElementById(a);c.duration=c.video.getDuration();c.dispatchEvent("load");c.dispatchEvent("durationchange")};d.youtube=function(a,c,b){return new d.youtube.init(a,c,b)};d.youtube.init=function(a,c,b){if(a){if(/file/.test(location.protocol))throw"This must be run from a web server.";}else throw"Element id is invalid.";b=b||{};var e=this;this.playerId=a+d.guid();this.readyState=0;this._eventListeners={};this.paused=this.fullyLoaded=this.loadedData=this.loadStarted=false;b.width=
b.width&&+b.width+"px";b.height=b.height&&+b.height+"px";this.controls=+b.controls===0||+b.controls===1?b.controls:1;this.iv_load_policy=+b.annotations===1||+b.annotations===3?b.annotations:1;this._target=document.getElementById(a);this._container=document.createElement("div");this._container.id=this.playerId;this._container.style.height=this._target.style.height=b.height||this._target.style.height||"350px";this._container.style.width=this._target.style.width=b.width||this._target.style.width||"460px";
this._target.appendChild(this._container);this.parentNode=this._target.parentNode;this.offsetHeight=+this._target.offsetHeight;this.offsetWidth=+this._target.offsetWidth;this.currentTime=this.previousCurrentTime=0;this.volume=this.previousVolume=this.preMuteVol=1;this.duration=0;this.vidId=i(c)||k(c);if(!this.vidId)throw"Could not find video id";this.addEventListener("load",function(){this.offsetWidth=this.video.offsetWidth;this.offsetHeight=this.video.offsetHeight;this.offsetParent=this.video.offsetParent;
this.registerYoutubeEventHandlers();this.registerInternalEventHandlers()});(function(){var l=0;e.addEventListener("playing",function(){if(!l){l=1;e.duration=e.video.getDuration();e.dispatchEvent("durationchange")}})})();if(f[this.playerId]){this.video=g[this.playerId].video;this.vidId=this.vidId||i(this._container.getAttribute("src"))||k(this._container.getAttribute("src"));if(this.vidId!==g[this.playerId].vidId)this.video.cueVideoById(this.vidId);else this.previousCurrentTime=1;this.dispatchEvent("load")}else this._container?
h.call(this,c,this._container):document.addEventListener("DOMContentLoaded",function(){e._container=document.getElementById(a);if(!e._container)throw"Could not find container!";h.call(e,c,e._container)},false);g[this.playerId]=this};d.extend(d.youtube.init.prototype,{registerYoutubeEventHandlers:function(){var a=this;this.video.addEventListener("onStateChange","Popcorn.youtube.stateChangeEventHandler");this.video.addEventListener("onError","Popcorn.youtube.errorEventHandler");d.youtube.stateChangeEventHandler=
function(c){var b=g[a.playerId];if(c===-1){b.readyState=1;b.dispatchEvent("loadedmetadata")}else if(c===0)b.dispatchEvent("ended");else if(c===1){if(!this.loadedData){this.loadedData=true;b.dispatchEvent("loadeddata")}b.readyState=2;b.dispatchEvent("playing")}else if(c===2)b.dispatchEvent("pause");else if(c===3)b.dispatchEvent("waiting");else c===5&&d.nop()};d.youtube.errorEventHandler=function(){a.dispatchEvent("error")}},registerInternalEventHandlers:function(){this.addEventListener("playing",function(){this.startTimeUpdater()});
this.addEventListener("loadedmetadata",function(){this.startProgressUpdater()})},play:function(){if(f[this.playerId]){this.dispatchEvent("play");this.video.playVideo()}else this.addEventListener("load",function(){this.play()})},pause:function(){f[this.playerId]?this.video.pauseVideo():this.addEventListener("load",this.pause)},load:function(){if(f[this.playerId]){this.video.playVideo();this.video.pauseVideo()}else this.addEventListener("load",function(){this.load()})},seekTo:function(a){var c=this.video.getPlayerState()==
1;this.video.seekTo(a,true);if(c)this.video.paused=false;else{this.video.paused=true;this.video.pauseVideo()}if(!this.fullyLoaded)this.loadedData=false;this.dispatchEvent("seeked")},mute:function(){if(f[this.playerId])if(this.volume!==0){this.preMuteVol=this.volume;this.setVolume(0)}else this.setVolume(this.preMuteVol);else this.addEventListener("load",this.mute)},setVolume:function(a){this.volume=this.previousVolume=a;this.video.setVolume(a*100);this.dispatchEvent("volumechange")},addEventListener:function(a,
c){var b=a.type||a;this._eventListeners[b]||(this._eventListeners[b]=[]);this._eventListeners[b].push(c)},dispatchEvent:function(a){a=a.type||a;if(this._eventListeners[a]){var c=this;d.forEach(this._eventListeners[a],function(b){b.call(c,null)})}},defaultPlaybackRate:function(){},playbackRate:function(){},getBoundingClientRect:function(){var a;if(this.video){a=this.video.getBoundingClientRect();return{bottom:a.bottom,left:a.left,right:a.right,top:a.top,width:a.width||a.right-a.left,height:a.height||
a.bottom-a.top}}else{a=this._container.getBoundingClientRect();return{left:a.left,top:a.top,width:this._target.offsetWidth,height:this._target.offsetHeight,bottom:a.top+this._target.offsetWidth,right:a.left+this._target.offsetHeight}}},startTimeUpdater:function(){var a=typeof this.video.getPlayerState!="function"?this.readyState:this.video.getPlayerState(),c=this,b=0;if(m(this.currentTime-this.previousCurrentTime)>0.5){this.previousCurrentTime=this.currentTime-0.5;this.seekTo(this.currentTime);b=
1}else{this.previousCurrentTime=this.currentTime;this.currentTime=typeof this.video.getCurrentTime!="function"?this.currentTime:this.video.getCurrentTime()}this.volume!==this.previousVolume&&this.setVolume(this.volume);if(a!==0&&a!==2||b)this.dispatchEvent("timeupdate");a!==0&&setTimeout(function(){c.startTimeUpdater.call(c)},33)},startProgressUpdater:function(){var a=this.video.getVideoBytesLoaded(),c=this.video.getVideoBytesTotal(),b=this;if(c!==0){if(!this.loadStarted){this.loadStarted=true;this.dispatchEvent("loadstart")}if(a>=
c){this.fullyLoaded=true;this.readyState=4;this.dispatchEvent("canplaythrough")}else{this.dispatchEvent("progress");setTimeout(function(){b.startProgressUpdater.call(b)},250)}}}})})(Popcorn);
