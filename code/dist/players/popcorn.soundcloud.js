(function(e,j){function i(b,a){if(b.currentStyle)return b.currentStyle[a];else if(j.getComputedStyle)return document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}function l(b){return'<div><a href="'+b.user.profile+'"><img width="16px height="16px" src="'+b.user.avatar+'"></img>'+b.user.name+"</a> at "+function(a){var d=m(a/60);a=h(a%60);return d+"."+(a<10?"0":"")+a}(b.start)+" "+function(a){function d(c,f){return c+" "+f+(c>1?"s":"")+" ago"}a=((new Date).getTime()-a.getTime())/1E3;if(a<
60)return d(h(a),"second");a/=60;if(a<60)return d(h(a),"minute");a/=60;if(a<24)return d(h(a),"hour");a/=24;if(a<30)return d(h(a),"day");if(a<365)return d(h(a/30),"month");return d(h(a/365),"year")}(b.date)+"<br />"+b.text+"</span>"}function k(b){if(j.swfobject&&j.soundcloud){var a={enable_api:true,object_id:b._playerId,url:b.src,show_comments:!b._options.api.key&&!b._options.api.commentdiv},d={id:b._playerId,name:b._playerId},c=document.createElement("div");c.setAttribute("id",b._playerId);b._container.appendChild(c);
swfobject.embedSWF("http://player.soundcloud.com/player.swf",b._playerId,b.offsetWidth,b.height,"9.0.0","expressInstall.swf",a,{allowscriptaccess:"always",wmode:"transparent"},d)}else setTimeout(function(){k(b)},15)}var n=Math.abs,m=Math.floor,h=Math.round,g={};e.getScript("http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js");e.getScript("http://popcornjs.org/code/players/soundcloud/lib/soundcloud.player.api.js",function(){var b=1;soundcloud.addEventListener("onPlayerReady",function(a,
d){var c=g[a.api_getFlashId()];c.swfObj=a;c.duration=a.api_getTrackDuration();c.currentTime=a.api_getTrackPosition();c.volume=c.previousVolume=a.api_getVolume()/100;c._mediaId=d.mediaId;c.dispatchEvent("load");c.dispatchEvent("canplay");c.dispatchEvent("durationchange");c.timeupdate()});soundcloud.addEventListener("onMediaStart",function(a){a=g[a.api_getFlashId()];a.played=1;a.dispatchEvent("playing")});soundcloud.addEventListener("onMediaPlay",function(a){if(b)b=0;else g[a.api_getFlashId()].dispatchEvent("play")});
soundcloud.addEventListener("onMediaPause",function(a){g[a.api_getFlashId()].dispatchEvent("pause")});soundcloud.addEventListener("onMediaBuffering",function(a){a=g[a.api_getFlashId()];a.dispatchEvent("progress");if(a.readyState===0){a.readyState=3;a.dispatchEvent("readystatechange")}});soundcloud.addEventListener("onMediaDoneBuffering",function(a){g[a.api_getFlashId()].dispatchEvent("canplaythrough")});soundcloud.addEventListener("onMediaEnd",function(a){a=g[a.api_getFlashId()];a.paused=1;a.dispatchEvent("ended")});
soundcloud.addEventListener("onMediaSeek",function(a){var d=g[a.api_getFlashId()];d.setCurrentTime(a.api_getTrackPosition());d.paused&&d.dispatchEvent("timeupdate")});soundcloud.addEventListener("onPlayerError",function(a){g[a.api_getFlashId()].dispatchEvent("error")})});e.soundcloud=function(b,a,d){return new e.soundcloud.init(b,a,d)};e.soundcloud.init=function(){function b(a){var d=a._options,c=a._container,f=c.getBoundingClientRect();a.width=d.width||i(c,"width")||"100%";a.height=d.height||i(c,
"height")||"81px";a.src=d.src;a.autoplay=d.autoplay;if(parseFloat(a.height,10)!==81)a.height="81px";a.offsetLeft=f.left;a.offsetTop=f.top;a.offsetHeight=parseFloat(a.height,10);a.offsetWidth=parseFloat(a.width,10);if(/[\d]+%/.test(a.width)){d=i(c,"width");a._container.style.width=a.width;a.offsetWidth=a._container.offsetWidth;a._container.style.width=d}if(/[\d]+%/.test(a.height)){d=i(c,"height");a._container.style.height=a.height;a.offsetHeight=a._container.offsetHeight;a._container.style.height=
d}}return function(a,d,c){if(a)if(d){if(/file/.test(location.protocol))throw"Must run from a web server!";}else throw"Must supply a source!";else throw"Must supply an id!";if(!(this._container=document.getElementById(a)))throw"Could not find that container in the DOM!";c=c||{};c.api=c.api||{};c.target=a;c.src=d;c.api.commentformat=c.api.commentformat||l;this._mediaId=0;this._listeners={};this._playerId=e.guid(c.target);this._containerId=c.target;this._options=c;this._comments=[];this._popcorn=null;
b(this);this.duration=0;this.volume=1;this.ended=this.currentTime=0;this.paused=1;this.readyState=0;this.playbackRate=1;this.left=this.top=0;this.autoplay=null;this.played=0;this.addEventListener("load",function(){var f=this.getBoundingClientRect();this.top=f.top;this.left=f.left;this.offsetWidth=this.swfObj.offsetWidth;this.offsetHeight=this.swfObj.offsetHeight;this.offsetLeft=this.swfObj.offsetLeft;this.offsetTop=this.swfObj.offsetTop});g[this._playerId]=this;k(this)}}();e.soundcloud.init.prototype=
e.soundcloud.prototype;e.extend(e.soundcloud.prototype,{setVolume:function(b){if(!(!b&&b!==0)){if(b<0)b=-b;if(b>1)b%=1;this.volume=this.previousVolume=b;this.swfObj.api_setVolume(b*100);this.dispatchEvent("volumechange")}},setCurrentTime:function(b){if(!(!b&&b!==0)){this.currentTime=this.previousCurrentTime=b;this.ended=b>=this.duration;this.dispatchEvent("seeked")}},play:function(){if(this.swfObj){if(this.paused){this.paused=0;this.swfObj.api_play()}}else this.addEventListener("load",this.play)},
pause:function(){if(this.swfObj){if(!this.paused){this.paused=1;this.swfObj.api_pause()}}else this.addEventListener("load",this.pause)},mute:function(){if(this.swfObj)if(this.muted())if(this.paused)this.setVolume(this.oldVol);else this.volume=this.oldVol;else{this.oldVol=this.volume;if(this.paused)this.setVolume(0);else this.volume=0}else this.addEventListener("load",this.mute)},muted:function(){return this.volume===0},load:function(){if(this.swfObj){this.play();this.pause()}else this.addEventListener("load",
this.load)},addEventListener:function(b,a){this._listeners[b]||(this._listeners[b]=[]);this._listeners[b].push(a);return a},dispatchEvent:function(b){var a=this;b=b.type||b;b==="play"&&this.paused||b==="pause"&&!this.paused?this[b]():e.forEach(this._listeners[b],function(d){d.call(a)})},timeupdate:function(){var b=this,a=this.swfObj.api_getVolume()/100;if(n(this.currentTime-this.previousCurrentTime)>0.25)this.swfObj.api_seekTo(this.currentTime);else this.previousCurrentTime=this.currentTime=this.swfObj.api_getTrackPosition();
if(a!==this.previousVolume)this.setVolume(a);else this.volume!==this.previousVolume&&this.setVolume(this.volume);this.paused||this.dispatchEvent("timeupdate");b.ended||setTimeout(function(){b.timeupdate.call(b)},33)},getBoundingClientRect:function(){var b;if(this.swfObj){b=this.swfObj.getBoundingClientRect();return{bottom:b.bottom,left:b.left,right:b.right,top:b.top,width:b.width||b.right-b.left,height:b.height||b.bottom-b.top}}else{tmp=this._container.getBoundingClientRect();return{left:tmp.left,
top:tmp.top,width:this.offsetWidth,height:this.offsetHeight,bottom:tmp.top+this.width,right:tmp.top+this.height}}},registerPopcornWithPlayer:function(b){if(this.swfObj){this._popcorn=b;var a=this._options.api;if(a.key&&a.commentdiv){var d=this;e.xhr({url:"http://api.soundcloud.com/tracks/"+d._mediaId+"/comments.js?consumer_key="+a.key,success:function(c){e.forEach(c.json,function(f){d.addComment({start:f.timestamp/1E3,date:new Date(f.created_at),text:f.body,user:{name:f.user.username,profile:f.user.permalink_url,
avatar:f.user.avatar_url}})})}})}}else this.addEventListener("load",function(){this.registerPopcornWithPlayer(b)})}});e.extend(e.soundcloud.prototype,{addComment:function(b,a){var d=this,c={start:b.start||0,date:b.date||new Date,text:b.text||"",user:{name:b.user.name||"",profile:b.user.profile||"",avatar:b.user.avatar||""},display:function(){return(a||d._options.api.commentformat)(c)}};this._comments.push(c);this._popcorn&&this._popcorn.subtitle({start:c.start,target:this._options.api.commentdiv,
display:"inline",language:"en",text:c.display()})}})})(Popcorn,window);
