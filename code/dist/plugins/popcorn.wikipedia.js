var wikiCallback;
(function(d){d.plugin("wikipedia",{manifest:{about:{name:"Popcorn Wikipedia Plugin",version:"0.1",author:"@annasob",website:"annasob.wordpress.com"},options:{start:{elem:"input",type:"text",label:"In"},end:{elem:"input",type:"text",label:"Out"},lang:{elem:"input",type:"text",label:"Language"},src:{elem:"input",type:"text",label:"Src"},title:{elem:"input",type:"text",label:"Title"},numberofwords:{elem:"input",type:"text",label:"Num Of Words"},target:"wikipedia-container"}},_setup:function(a){var b,c=
d.guid();if(!a.lang)a.lang="en";a.numberofwords=a.numberofwords||200;window["wikiCallback"+c]=function(e){a._link=document.createElement("a");a._link.setAttribute("href",a.src);a._link.setAttribute("target","_blank");a._link.innerHTML=a.title||e.parse.displaytitle;a._desc=document.createElement("p");b=e.parse.text["*"].substr(e.parse.text["*"].indexOf("<p>"));b=b.replace(/((<(.|\n)+?>)|(\((.*?)\) )|(\[(.*?)\]))/g,"");b=b.split(" ");a._desc.innerHTML=b.slice(0,b.length>=a.numberofwords?a.numberofwords:
b.length).join(" ")+" ...";a._fired=true};if(a.src)d.getScript("http://"+a.lang+".wikipedia.org/w/api.php?action=parse&props=text&page="+a.src.slice(a.src.lastIndexOf("/")+1)+"&format=json&callback=wikiCallback"+c);else if(d.plugin.debug)throw Error("Wikipedia plugin needs a 'src'");},start:function(a,b){var c=function(){if(b._fired){if(b._link&&b._desc)if(document.getElementById(b.target)){document.getElementById(b.target).appendChild(b._link);document.getElementById(b.target).appendChild(b._desc);
b._added=true}}else setTimeout(function(){c()},13)};c()},end:function(a,b){if(b._added){document.getElementById(b.target).removeChild(b._link);document.getElementById(b.target).removeChild(b._desc)}},_teardown:function(a){if(a._added){a._link.parentNode&&document.getElementById(a.target).removeChild(a._link);a._desc.parentNode&&document.getElementById(a.target).removeChild(a._desc);delete a.target}}})})(Popcorn);
